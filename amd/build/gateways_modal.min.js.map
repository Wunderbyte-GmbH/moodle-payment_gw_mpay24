{"version":3,"sources":["../src/gateways_modal.js"],"names":["showModalWithPlaceholder","ModalFactory","Templates","render","body","create","modal","show","process","component","paymentArea","itemId","Promise","all","Repository","getConfigForJs","then","mpay24Config","require","$","redirectpayment","document","ready","init","tid","promise","window","addEventListener","resolve"],"mappings":"8hBAyBA,OACA,OACA,OACA,OACA,O,u3DAUMA,CAAAA,CAAwB,4CAAG,yGACTC,SADS,gBAEbC,WAAUC,MAAV,CAAiB,wCAAjB,CAA2D,EAA3D,CAFa,0BAEzBC,IAFyB,4BACIC,MADJ,wBACvBC,CADuB,QAI7BA,CAAK,CAACC,IAAN,GAJ6B,yBAKtBD,CALsB,2CAAH,uD,CAiBjBE,CAAO,CAAG,SAACC,CAAD,CAAYC,CAAZ,CAAyBC,CAAzB,CAAiD,CACpE,MAAOC,CAAAA,OAAO,CAACC,GAAR,CAAY,CACXb,CAAwB,EADb,CAEXc,CAAU,CAACC,cAAX,CAA0BN,CAA1B,CAAqCC,CAArC,CAAkDC,CAAlD,CAFW,CAAZ,EAIFK,IAJE,CAIG,WAA2B,cAAzBV,CAAyB,MAAlBW,CAAkB,MAC7B,MAAOL,CAAAA,OAAO,CAACC,GAAR,CAAY,CACfP,CADe,CAEfW,CAFe,CAAZ,CAIV,CATE,EAUFD,IAVE,CAUG,WAA2B,cAAzBV,CAAyB,MAAlBW,CAAkB,MAC7BC,OAAO,CAAC,CAAC,QAAD,CAAW,8BAAX,CAAD,CAA6C,SAASC,CAAT,CAAYC,CAAZ,CAA6B,CAC7ED,CAAC,CAACE,QAAD,CAAD,CAAYC,KAAZ,CAAkB,UAAW,CACzBF,CAAe,CAACG,IAAhB,CAAqBd,CAArB,CACeC,CADf,CAEeC,CAFf,CAGeM,CAAY,CAACO,GAH5B,CAIH,CALD,CAMA,CAPG,CAAP,CASA,MAAO,EAEV,CAtBE,EAsBAR,IAtBA,CAsBK,UAAK,CACT,GAAMS,CAAAA,CAAO,CAAG,GAAIb,CAAAA,OAAJ,CAAY,UAAW,CACnCc,MAAM,CAACC,gBAAP,CAAwB,gBAAxB,CAA0C,UAAO,CAC7CF,CAAO,CAACG,OAAR,EACH,CAFD,CAGH,CAJe,CAAhB,CAKA,MAAOH,CAAAA,CACV,CA7BE,CA8BV,C","sourcesContent":["/* eslint-disable max-len */\n/* eslint-disable no-unused-vars */\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This module is responsible for mpay24 content in the gateways modal.\n *\n * @module     paygw_mpay24/gateway_modal\n * @copyright  2022 Wunderbyte Gmbh <info@wunderbyte.at>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport * as Repository from './repository';\nimport Templates from 'core/templates';\nimport Truncate from 'core/truncate';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport {\n    get_string as getString\n} from 'core/str';\n\n/**\n * Creates and shows a modal that contains a placeholder.\n *\n * @returns {Promise<Modal>}\n */\nconst showModalWithPlaceholder = async () => {\n    const modal = await ModalFactory.create({\n        body: await Templates.render('paygw_mpay24/mpay24_button_placeholder', {})\n    });\n    modal.show();\n    return modal;\n};\n\n/**\n * Process the payment.\n *\n * @param {string} component Name of the component that the itemId belongs to\n * @param {string} paymentArea The area of the component that the itemId belongs to\n * @param {number} itemId An internal identifier that is used by the component\n * @param {string} description Description of the payment\n * @returns {Promise<string>}\n */\nexport const process = (component, paymentArea, itemId, description) => {\n    return Promise.all([\n            showModalWithPlaceholder(),\n            Repository.getConfigForJs(component, paymentArea, itemId),\n        ])\n        .then(([modal, mpay24Config]) => {\n            return Promise.all([\n                modal,\n                mpay24Config,\n            ]);\n        })\n        .then(([modal, mpay24Config]) => {\n            require(['jquery', 'paygw_mpay24/redirectpayment'], function($, redirectpayment) {\n                $(document).ready(function() {\n                    redirectpayment.init(component,\n                                   paymentArea,\n                                   itemId,\n                                   mpay24Config.tid);\n                });\n               });\n\n            return '';\n\n        }).then(x => {\n            const promise = new Promise(resolve => {\n                window.addEventListener('onbeforeunload', (e) => {\n                    promise.resolve();\n                });\n            });\n            return promise;\n        });\n};"],"file":"gateways_modal.min.js"}